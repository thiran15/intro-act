angular.module("ui.sortable",[]).value("uiSortableConfig",{items:"> [ng-repeat],> [data-ng-repeat],> [x-ng-repeat]"}).directive("uiSortable",["uiSortableConfig","$timeout","$log",function(a,b,c){return{require:"?ngModel",scope:{ngModel:"=",uiSortable:"="},link:function(d,e,f,g){function i(a,b){var c="function"==typeof a,d="function"==typeof b;return c&&d?function(){a.apply(this,arguments),b.apply(this,arguments)}:d?b:a}function j(a){var b=a.data("ui-sortable");return b&&"object"==typeof b&&"ui-sortable"===b.widgetFullName?b:null}function k(b,c){return w[b]?("stop"===b&&(c=i(c,function(){d.$apply()}),c=i(c,s)),c=i(w[b],c)):x[b]&&(c=x[b](c)),c||"items"!==b&&"ui-model-items"!==b||(c=a.items),c}function l(a,b,c){function d(a,b){b in u||(u[b]=null)}angular.forEach(w,d);var e=null;if(b){var f;angular.forEach(b,function(b,c){if(!(a&&c in a)){if(c in v)return void("ui-floating"===c?u[c]="auto":u[c]=k(c,void 0));f||(f=angular.element.ui.sortable().options);var d=f[c];d=k(c,d),e||(e={}),e[c]=d,u[c]=d}})}return angular.forEach(a,function(a,b){return b in v?("ui-floating"!==b||a!==!1&&a!==!0||!c||(c.floating=a),void(u[b]=k(b,a))):(a=k(b,a),e||(e={}),e[b]=a,void(u[b]=a))}),e}function m(a){var b=a.sortable("option","placeholder");if(b&&b.element&&"function"==typeof b.element){var c=b.element();return c=angular.element(c)}return null}function n(a,b){var c=u["ui-model-items"].replace(/[^,]*>/g,""),d=a.find('[class="'+b.attr("class")+'"]:not('+c+")");return d}function o(a,b){var c=a.sortable("option","helper");return"clone"===c||"function"==typeof c&&b.item.sortable.isCustomHelperUsed()}function p(a,b,c){var d=null;return o(a,b)&&"parent"===a.sortable("option","appendTo")&&(d=c.last()),d}function q(a){return/left|right/.test(a.css("float"))||/inline|table-cell/.test(a.css("display"))}function r(a,b){for(var c=null,d=0;d<a.length;d++){var e=a[d];if(e.element[0]===b[0]){c=e.scope;break}}return c}function s(a,b){b.item.sortable._destroy()}function t(a){return a.parent().find(u["ui-model-items"]).index(a)}function y(){d.$watchCollection("ngModel",function(){b(function(){j(e)&&e.sortable("refresh")},0,!1)}),w.start=function(a,b){if("auto"===u["ui-floating"]){var c=b.item.siblings(),d=j(angular.element(a.target));d.floating=q(c)}var e=t(b.item);b.item.sortable={model:g.$modelValue[e],index:e,source:b.item.parent(),sourceModel:g.$modelValue,cancel:function(){b.item.sortable._isCanceled=!0},isCanceled:function(){return b.item.sortable._isCanceled},isCustomHelperUsed:function(){return!!b.item.sortable._isCustomHelperUsed},_isCanceled:!1,_isCustomHelperUsed:b.item.sortable._isCustomHelperUsed,_destroy:function(){angular.forEach(b.item.sortable,function(a,c){b.item.sortable[c]=void 0})}}},w.activate=function(a,b){h=e.contents();var c=m(e);if(c&&c.length){var f=n(e,c);h=h.not(f)}var g=b.item.sortable._connectedSortables||[];g.push({element:e,scope:d}),b.item.sortable._connectedSortables=g},w.update=function(a,b){if(!b.item.sortable.received){b.item.sortable.dropindex=t(b.item);var c=b.item.parent();b.item.sortable.droptarget=c;var f=r(b.item.sortable._connectedSortables,c);b.item.sortable.droptargetModel=f.ngModel,e.sortable("cancel")}var i=!b.item.sortable.received&&p(e,b,h);i&&i.length&&(h=h.not(i)),h.appendTo(e),b.item.sortable.received&&(h=null),b.item.sortable.received&&!b.item.sortable.isCanceled()&&d.$apply(function(){g.$modelValue.splice(b.item.sortable.dropindex,0,b.item.sortable.moved)})},w.stop=function(a,b){if(!b.item.sortable.received&&"dropindex"in b.item.sortable&&!b.item.sortable.isCanceled())d.$apply(function(){g.$modelValue.splice(b.item.sortable.dropindex,0,g.$modelValue.splice(b.item.sortable.index,1)[0])});else if((!("dropindex"in b.item.sortable)||b.item.sortable.isCanceled())&&!angular.equals(e.contents(),h)){var c=p(e,b,h);c&&c.length&&(h=h.not(c)),h.appendTo(e)}h=null},w.receive=function(a,b){b.item.sortable.received=!0},w.remove=function(a,b){"dropindex"in b.item.sortable||(e.sortable("cancel"),b.item.sortable.cancel()),b.item.sortable.isCanceled()||d.$apply(function(){b.item.sortable.moved=g.$modelValue.splice(b.item.sortable.index,1)[0]})},x.helper=function(a){return a&&"function"==typeof a?function(b,c){var d=c.sortable,e=t(c);c.sortable={model:g.$modelValue[e],index:e,source:c.parent(),sourceModel:g.$modelValue,_restore:function(){angular.forEach(c.sortable,function(a,b){c.sortable[b]=void 0}),c.sortable=d}};var f=a.apply(this,arguments);return c.sortable._restore(),c.sortable._isCustomHelperUsed=c!==f,f}:a},d.$watchCollection("uiSortable",function(a,b){var c=j(e);if(c){var d=l(a,b,c);d&&e.sortable("option",d)}},!0),l(u)}function z(){g?y():c.info("ui.sortable: ngModel not provided!",e),e.sortable(u)}function A(){return(!d.uiSortable||!d.uiSortable.disabled)&&(z(),A.cancelWatcher(),A.cancelWatcher=angular.noop,!0)}var h,u={},v={"ui-floating":void 0,"ui-model-items":a.items},w={receive:null,remove:null,start:null,stop:null,update:null},x={helper:null};return angular.extend(u,v,a,d.uiSortable),angular.element.fn&&angular.element.fn.jquery?(A.cancelWatcher=angular.noop,void(A()||(A.cancelWatcher=d.$watch("uiSortable.disabled",A)))):void c.error("ui.sortable: jQuery should be included before AngularJS!")}}}]);